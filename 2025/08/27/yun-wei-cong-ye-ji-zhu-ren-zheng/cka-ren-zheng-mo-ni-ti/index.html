<!DOCTYPE HTML>
<html lang="zh-CN">
    

    

<head>
    <meta charset="utf-8">
    <meta name="keywords" content="CKA认证模拟题, Linux技术博客">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style"
        content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>CKA认证模拟题 | Linux技术博客</title>
    <link rel="icon" type="image/png"
        href="/favicon.png">

    <link rel="stylesheet" type="text/css"
        href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css"
        href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css"
        href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css"
        href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css"
        href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css"
        href="/css/matery.css">
    <link rel="stylesheet" type="text/css"
        href="/css/my.css">
    <link rel="stylesheet" type="text/css"
        href="/css/loading.css">

    <script
        src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Linux技术博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


    
    <style>
    body{
       background-image: url(/medias/background.jpg);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>

    
    <body>
        <div class="stars-con">
            <div id="stars"></div>
            <div id="stars2"></div>
            <div id="stars3"></div>
        </div>
        <svg aria-hidden="true"
            style="position: absolute; overflow: hidden; width: 0; height: 0">
            <symbol id="icon-sun" viewBox="0 0 1024 1024">
                <path
                    d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z"
                    fill="#FFD878" p-id="8420"></path>
                <path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z"
                    fill="#FFE4A9" p-id="8421"></path>
                <path
                    d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z"
                    fill="#4D5152" p-id="8422"></path>
                <path
                    d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z"
                    fill="#4D5152" p-id="8423"></path>
            </symbol>
            <symbol id="icon-moon" viewBox="0 0 1024 1024">
                <path
                    d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z"
                    fill="#FFB531" p-id="11345"></path>
                <path
                    d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z"
                    fill="#030835" p-id="11346"></path>
            </symbol>
        </svg>
        <a onclick="switchNightMode()" class="icon-V hidden" title="切换主题">
            <svg width="48" height="48" viewBox="0 0 1024 1024">
                <use id="modeicon" xlink:href="#icon-moon"></use>
            </svg>
        </a>
        <script>
      function checkNightMode() {
        '1' === localStorage.getItem('isDark') ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : '0' === localStorage.getItem('isDark') ? $('#modeicon').attr('xlink:href', '#icon-moon') : new Date().getHours() >= 20 || new Date().getHours() < 7 ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : matchMedia('(prefers-color-scheme: dark)').matches ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : $('#modeicon').attr('xlink:href', '#icon-moon')
      }
      function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
          setTimeout(function () {
            $('body').hasClass('DarkMode') ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#changeMode-top').removeClass('fa-sun').addClass('fa-moon'), $('#modeicon').attr('xlink:href', '#icon-moon')) : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')),
              setTimeout(function () {
                $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                  $(this).remove()
                })
              }, 2e3)
          })
      }
      function switchNightModeTop() {
        $('body').hasClass('DarkMode') ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#changeMode-top').removeClass('fa-sun').addClass('fa-moon'), $('#modeicon').attr('xlink:href', '#icon-moon')) : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun'))
      }
    </script>

        <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Linux技术博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Linux技术博客</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/luovip/tecBlog.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/luovip/tecBlog.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

        



<div class="bg-cover pd-header post-cover" style="background-image: url('/img/K8S&practice.jpeg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CKA认证模拟题</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet"
    href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }
    #toc-content .toc-link:hover {
        color: #f40;
        font-weight: 700;
        text-decoration: underline;
    }
    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #f40;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CKA%E8%AE%A4%E8%AF%81%E6%A8%A1%E6%8B%9F%E9%A2%98/">
                                <span class="chip bg-color">CKA认证模拟题</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%BF%90%E7%BB%B4%E4%BB%8E%E4%B8%9A%E6%8A%80%E6%9C%AF%E8%AE%A4%E8%AF%81/" class="post-category">
                                运维从业技术认证
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-08-27
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-09-01
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    51 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="题目1-HPA"><a href="#题目1-HPA" class="headerlink" title="题目1: HPA"></a><strong>题目1</strong>: HPA</h1><p>  在<code>autoscale</code> namespace 中找到一个名为 <code>apache-server</code> 的deployment，为这个deployment创建一个名为 <code>apache-server</code> 的新 HorizontalPodAutoscaler(HPA)</p>
<p>  将 HPA 设置为每个 Pod 的 CPU 使用率定在 <code>50%</code> 。将其配置为至少有 <code>1</code> 个 Pod，且不超过 <code>4</code> 个 Pod 。此外，将缩容稳定窗口设置为 <code>30</code> 秒。</p>
<p>  <strong>查看本题环境准备情况：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get pod -n autoscale</span>
NAME                             READY   STATUS    RESTARTS   AGE
apache-server-8495b5dd5b-rlkb9   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3d13h

root@k8s-master:~<span class="token comment"># kubectl get deployments.apps -n autoscale</span>
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
apache-server   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           3d13h

root@k8s-master:~<span class="token comment"># kubectl get hpa -n autoscale</span>
No resources found <span class="token keyword">in</span> autoscale namespace.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析:</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，复制粘贴就行</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl config use-context kubernetes-admin@kubernetes</span>
Switched to context "kubernetes<span class="token punctuation">-</span>admin@kubernetes".

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ssh root@k8s-master</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># vim hpa.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> autoscaling/v2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HorizontalPodAutoscaler
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> apache<span class="token punctuation">-</span>server
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> autoscale
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">scaleTargetRef</span><span class="token punctuation">:</span>
    <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
    <span class="token key atrule">name</span><span class="token punctuation">:</span> apache<span class="token punctuation">-</span>server
  <span class="token key atrule">minReplicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">maxReplicas</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token key atrule">metrics</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> Resource
    <span class="token key atrule">resource</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> cpu
      <span class="token key atrule">target</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> Utilization
        <span class="token key atrule">averageUtilization</span><span class="token punctuation">:</span> <span class="token number">50</span>
  <span class="token key atrule">behavior</span><span class="token punctuation">:</span>
    <span class="token key atrule">scaleDown</span><span class="token punctuation">:</span>
      <span class="token key atrule">stabilizationWindowSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl create -f hpa.yml</span>
horizontalpodautoscaler.autoscaling/apache<span class="token punctuation">-</span>server created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>检查:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get -f hpa.yml</span>
NAME            REFERENCE                  TARGETS       MINPODS   MAXPODS   REPLICAS   AGE
apache-server   Deployment/apache-server   cpu: <span class="token number">1</span>%/50%   <span class="token number">1</span>         <span class="token number">4</span>         <span class="token number">1</span>          8m46s

root@k8s-master:~<span class="token comment"># kubectl describe hpa apache-server -n autoscale</span>
Name:                                                  apache-server
Namespace:                                             autoscale
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Metrics:                                               <span class="token punctuation">(</span> current / target <span class="token punctuation">)</span>
  resource cpu on pods  <span class="token punctuation">(</span>as a percentage of request<span class="token punctuation">)</span>:  <span class="token number">1</span>% <span class="token punctuation">(</span>1m<span class="token punctuation">)</span> / <span class="token number">50</span>%
Min replicas:                                          <span class="token number">1</span>
Max replicas:                                          <span class="token number">4</span>
Behavior:
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
  Scale Down:
    Stabilization Window: <span class="token number">30</span> seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目2-Ingress"><a href="#题目2-Ingress" class="headerlink" title="题目2: Ingress"></a><strong>题目2</strong>: Ingress</h1><p>  创建如下ingress资源：</p>
<p>   名称：<code>echo</code></p>
<p>   Namespace: <code>sound-repeater</code></p>
<p>   使用service端口8080在 <code>http://ingress-q2.linuxcenter.cn/echo</code> 上公开名为<code>echoserver-service</code>的服务</p>
<p>  验证：</p>
<p>   访问 curl -kL <a target="_blank" rel="noopener" href="http://ingress-q2.linuxcenter.cn/echo">http://ingress-q2.linuxcenter.cn/echo</a> 会返回 <code>hello world</code></p>
<p>   访问 <code>curl -o /dev/null -s -w "%{http_code}\n" http://ingress-q2.linuxcenter.cn/echo</code> 会输出200</p>
<p>  <strong>解析:</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不要忘了切换集群，每道题前面都有ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ssh root@k8s-master</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># vim ingress.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> echo
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> sound<span class="token punctuation">-</span>repeater
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">nginx.ingress.kubernetes.io/rewrite-target</span><span class="token punctuation">:</span> /
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ingressClassName</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>q2.linuxcenter.cn
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">"/echo"</span>
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> echoserver<span class="token punctuation">-</span>service
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">8080</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl create -f ingress.yml</span>
ingress.networking.k8s.io/echo created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>检查:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get ingress -n sound-repeater</span>
NAME   CLASS   HOSTS                       ADDRESS                   PORTS   AGE
<span class="token builtin class-name">echo</span>   nginx   ingress-q2.linuxcenter.cn   <span class="token number">192.168</span>.8.4,192.168.8.5   <span class="token number">80</span>      34s

root@k8s-master:~<span class="token comment"># curl -kL http://ingress-q2.linuxcenter.cn/echo</span>
hello world

root@k8s-master:~<span class="token comment"># curl -o /dev/null -s -w "%{http_code}\n" http://ingress-q2.linuxcenter.cn/echo</span>
<span class="token number">200</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目3-Sidecar"><a href="#题目3-Sidecar" class="headerlink" title="题目3: Sidecar"></a><strong>题目3</strong>: Sidecar</h1><p>  您需要将一个传统应用程序集成到 Kubernetes 的日志架构(例如 kubectl logs)中。</p>
<p>  实现这个要求的通常方法是添加一个流式传输并置容器:</p>
<p>  更新现有名为 <code>synergy-leverager</code> 的Deployment</p>
<p>   添加一个容器名称为 <code>busybox</code> 且镜像为 <code>busybox:stable</code>的 sidecar 类型容器</p>
<p>   这个sidecar的启动命令为 <code>/bin/sh, -c, 'tail -n+1 -f /var/log/legacy-app.log'</code></p>
<p>   这个sidecar和原有的容器都必须同时挂载一个名为 <code>logs</code> 的volume，挂载的目录为 <code>/var/log/</code></p>
<p>  除了添加所需的卷挂载之外，请勿修改现有容器的规范。</p>
<p>  <strong>解析:</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ssh root@k8s-master</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl get deployments.apps synergy-leverager</span>
NAME                READY   UP<span class="token punctuation">-</span>TO<span class="token punctuation">-</span>DATE   AVAILABLE   AGE
synergy<span class="token punctuation">-</span>leverager   1/1     1            1           3d15h

<span class="token comment"># 导出现有deployment的yaml用于备份</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl get deployments.apps synergy-leverager -o yaml &gt; sidecar.yml</span>

<span class="token comment"># 直接编辑资源</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl edit deployments.apps synergy-leverager</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token punctuation">...</span>.
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">...</span>
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token comment"># 找到第一个容器，在下面添加volumeMounts参数，添加下面的logs卷</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs
            <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log
          <span class="token punctuation">...</span>
        <span class="token comment"># 新加一个容器</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
        <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span>stable <span class="token comment">#这里自己找加速器或者找一个可用的仓库地址就行</span>
        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>/bin/sh<span class="token punctuation">,</span> <span class="token punctuation">-</span>c<span class="token punctuation">,</span> <span class="token string">'tail -n+1 -f /var/log/legacy-app.log'</span><span class="token punctuation">]</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs
            <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log
      <span class="token punctuation">...</span>
  <span class="token comment"># 创建出这个卷，需要注意的是，如果本来就有volumes参数，请在它本来的volumes参数下面写logs卷的创建，不然就自己写volumes参数，注意对齐的格式</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs
          <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl edit deployments.apps synergy-leverager</span>
deployment.apps/synergy<span class="token punctuation">-</span>leverager edited

<span class="token comment"># 确认没问题就行，你的pod名称未必是这个，自己TAB</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>验证:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get pod</span>
NAME                                      READY   STATUS             RESTARTS   AGE
nfs-client-provisioner-5998cfc9bc-gmkrh   <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3d16h
synergy-leverager-67ff8bb4bf-p88f2        <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3d16h
synergy-leverager-75f46879f9-v77gc        <span class="token number">1</span>/2     ImagePullBackOff   <span class="token number">0</span>          24m
web-6f7fff8685-zmntq                      <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3d16h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解决镜像问题:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 考试时无需解决镜像拉取失败的问题</span>

root@k8s-master:~<span class="token comment"># kubectl describe pod synergy-leverager-75f46879f9-v77gc</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Events:
  Type     Reason     Age                  From               Message
  ----     ------     ----                 ----               -------
  Normal   Scheduled  26m                  default-scheduler  Successfully assigned default/synergy-leverager-75f46879f9-v77gc to k8s-worker2
  Warning  Failed     26m                  kubelet            Failed to pull image <span class="token string">"busybox:stable"</span><span class="token builtin class-name">:</span> Error response from daemon: Get <span class="token string">"https://registry-1.docker.io/v2/"</span><span class="token builtin class-name">:</span> context deadline exceeded <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span>
  Normal   Pulled     26m                  kubelet            Container image <span class="token string">"docker.io/library/busybox"</span> already present on machine
  Normal   Created    26m                  kubelet            Created container: legacy
  Normal   Started    26m                  kubelet            Started container legacy
  Normal   Pulling    22m <span class="token punctuation">(</span>x5 over 26m<span class="token punctuation">)</span>    kubelet            Pulling image <span class="token string">"busybox:stable"</span>
  Warning  Failed     22m <span class="token punctuation">(</span>x5 over 26m<span class="token punctuation">)</span>    kubelet            Error: ErrImagePull
  Warning  Failed     22m <span class="token punctuation">(</span>x4 over 25m<span class="token punctuation">)</span>    kubelet            Failed to pull image <span class="token string">"busybox:stable"</span><span class="token builtin class-name">:</span> Error response from daemon: Get <span class="token string">"https://registry-1.docker.io/v2/"</span><span class="token builtin class-name">:</span> net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span>
  Normal   BackOff    94s <span class="token punctuation">(</span>x98 over 26m<span class="token punctuation">)</span>   kubelet            Back-off pulling image <span class="token string">"busybox:stable"</span>
  Warning  Failed     71s <span class="token punctuation">(</span>x100 over 26m<span class="token punctuation">)</span>  kubelet            Error: ImagePullBackOff<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目4-StorageClass"><a href="#题目4-StorageClass" class="headerlink" title="题目4: StorageClass"></a><strong>题目4</strong>: StorageClass</h1><p>  首先，为名为 <code>cnlxh/nfs-storage</code> 的存储类制备器，创建一个名为 <code>cka-sc</code> 的新 StorageClass</p>
<p>  将卷绑定模式设置为 <code>WaitForFirstConsumer</code></p>
<p><strong>注意，没有设置卷绑定模式，或者将其设置为 WaitForFirstConsumer 之外的其他任何模式，都将导致分数降低。</strong></p>
<p>  接下来，将 <code>cka-sc</code> StorageClass 配置为默认的 StorageClass</p>
<p><strong>请勿修改任何现有的 Deployment 和 PersistentVolumeClaim，否则将导致分数降低。</strong></p>
<p>  <strong>解析:</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ssh root@k8s-master</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># vim sc.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cka<span class="token punctuation">-</span>sc
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">storageclass.kubernetes.io/is-default-class</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> cnlxh/nfs<span class="token punctuation">-</span>storage
<span class="token key atrule">volumeBindingMode</span><span class="token punctuation">:</span> WaitForFirstConsumer

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl create -f sc.yml</span>
storageclass.storage.k8s.io/cka<span class="token punctuation">-</span>sc created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>验证:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get storageclasses.storage.k8s.io</span>
NAME               PROVISIONER         RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
cka-sc <span class="token punctuation">(</span>default<span class="token punctuation">)</span>   cnlxh/nfs-storage   Delete          WaitForFirstConsumer   <span class="token boolean">false</span>                  4m20s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h1 id="题目5-service"><a href="#题目5-service" class="headerlink" title="题目5: service"></a><strong>题目5</strong>: service</h1><p>  重新配置一个位于<code>spline-reticulator</code> namespace中且名为<code>front-end</code>的deployment</p>
<p>  在名字为<code>nginx</code>的容器里面添加一个端口配置，端口名字为<code>http</code>，暴露端口号为<code>80/tcp</code></p>
<p>  然后创建一个名为<code>front-end-svc</code>且service的类型为<code>NodePort</code>的service，用于暴露容器的http端口。</p>
<p>  <strong>解析:</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ssh root@k8s-master</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl edit deployments.apps -n spline-reticulator front-end</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token comment">#添加了这里几行</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> http
          <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
<span class="token punctuation">...</span>

<span class="token comment"># 以NodePort方式暴露端口并验证</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl expose deployment -n spline-reticulator front-end --port=80 --target-port=80 --name=front-end-svc --type=NodePort</span>
service/front<span class="token punctuation">-</span>end<span class="token punctuation">-</span>svc exposed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>验证:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get service -n spline-reticulator</span>
NAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
front-end-svc   NodePort   <span class="token number">10.100</span>.109.43   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:31403/TCP   56s

root@k8s-master:~<span class="token comment"># kubectl describe -n spline-reticulator service front-end-svc</span>
Name:                     front-end-svc
Namespace:                spline-reticulator
Labels:                   <span class="token assign-left variable">app</span><span class="token operator">=</span>front-end
Annotations:              <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Selector:                 <span class="token assign-left variable">app</span><span class="token operator">=</span>front-end
Type:                     NodePort
IP Family Policy:         SingleStack
IP Families:              IPv4
IP:                       <span class="token number">10.100</span>.109.43
IPs:                      <span class="token number">10.100</span>.109.43
Port:                     <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>  <span class="token number">80</span>/TCP
TargetPort:               <span class="token number">80</span>/TCP
NodePort:                 <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>  <span class="token number">31403</span>/TCP
Endpoints:                <span class="token number">172.16</span>.194.77:80
Session Affinity:         None
External Traffic Policy:  Cluster
Internal Traffic Policy:  Cluster
Events:                   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

root@k8s-master:~<span class="token comment"># curl 10.100.109.43</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>

root@k8s-master:~<span class="token comment"># curl 192.168.8.3:31403</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目6-PriorityClass"><a href="#题目6-PriorityClass" class="headerlink" title="题目6: PriorityClass"></a><strong>题目6</strong>: PriorityClass</h1><p>  为用户工作负载创建一个名为 <code>high-priority</code> 的新 PriorityClass ，其值比用户定义的现有最高PriorityClass值小一个优先级。</p>
<p>  修改在 <code>priority</code> namespace 中运行的现有 <code>busybox-logger</code> Deployment ，以使用 <code>high-priority</code> 的PriorityClass。</p>
<p>  确保 <code>busybox-logger</code> Deployment 在设置了新PriorityClass后成功部署。</p>
<p><strong>请勿修改在 <code>priority</code> namespace 中运行的其他 Deployment，否则可能导致分数降低。</strong></p>
<p>  <strong>分析:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># 先看看现有的用户自己定义最高的数字是多少，看完之后，发现是1000000000</span>
root@k8s-master:~<span class="token comment"># kubectl get priorityclasses.scheduling.k8s.io</span>
NAME                      VALUE        GLOBAL-DEFAULT   AGE     PREEMPTIONPOLICY
max-user-prloruty         <span class="token number">1000000000</span>   <span class="token boolean">false</span>            3d18h   PreemptLowerPriority
system-cluster-critical   <span class="token number">2000000000</span>   <span class="token boolean">false</span>            55d     PreemptLowerPriority
system-node-critical      <span class="token number">2000001000</span>   <span class="token boolean">false</span>            55d     PreemptLowerPriority

root@k8s-master:~<span class="token comment"># bc</span>
<span class="token function">bc</span> <span class="token number">1.07</span>.1
Copyright <span class="token number">1991</span>-1994, <span class="token number">1997</span>, <span class="token number">1998</span>, <span class="token number">2000</span>, <span class="token number">2004</span>, <span class="token number">2006</span>, <span class="token number">2008</span>, <span class="token number">2012</span>-2017 Free Software Foundation, Inc.
This is <span class="token function">free</span> software with ABSOLUTELY NO WARRANTY.
For details <span class="token builtin class-name">type</span> `warranty'.
<span class="token number">1000000000</span> - <span class="token number">1</span>
<span class="token number">999999999</span>
quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建一个新的，比用户自带的那个少一个就行</span>
root@k8s-master:~<span class="token comment"># vim new-priority.yaml</span>
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: high-priority
value: <span class="token number">999999999</span>
globalDefault: <span class="token boolean">false</span>
description: <span class="token string">"This priority class is created by yu luo."</span>

root@k8s-master:~<span class="token comment"># kubectl create -f new-priority.yaml</span>
priorityclass.scheduling.k8s.io/high-priority created

<span class="token comment"># 验证优先级类是否已改好</span>
root@k8s-master:~<span class="token comment"># kubectl get priorityclasses.scheduling.k8s.io</span>
NAME                      VALUE        GLOBAL-DEFAULT   AGE     PREEMPTIONPOLICY
high-priority             <span class="token number">999999999</span>    <span class="token boolean">false</span>            5m39s   PreemptLowerPriority
max-user-prloruty         <span class="token number">1000000000</span>   <span class="token boolean">false</span>            3d18h   PreemptLowerPriority
system-cluster-critical   <span class="token number">2000000000</span>   <span class="token boolean">false</span>            55d     PreemptLowerPriority
system-node-critical      <span class="token number">2000001000</span>   <span class="token boolean">false</span>            55d     PreemptLowerPriority

<span class="token comment"># 从参考链接上，我们发现，Deployment里的priority参数要和pod中spec的下一级对齐，如果不会写不要紧的，看看explain怎么说就行</span>
root@k8s-master:~<span class="token comment"># kubectl explain deploy.spec.template.spec.priorityClassName</span>

root@k8s-master:~<span class="token comment"># kubectl edit deployments.apps busybox-logger -n priority</span>
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      priorityClassName: high-priority
      containers:
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>验证:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get pod -n priority</span>
NAME                              READY   STATUS    RESTARTS   AGE
busybox-logger-5db5f9df74-xfgtf   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          81s

root@k8s-master:~<span class="token comment"># kubectl get pod -n priority -o yaml | more</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
priority: <span class="token number">999999999</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

root@k8s-master:~<span class="token comment"># kubectl describe pod -n priority busybox-logger-5db5f9df74-xfgtf | grep -i priority: -A 2</span>
Priority:             <span class="token number">999999999</span>
Priority Class Name:  high-priority
Service Account:      default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目7-Argo-CD"><a href="#题目7-Argo-CD" class="headerlink" title="题目7: Argo CD"></a><strong>题目7</strong>: Argo CD</h1><p>  文档 <a target="_blank" rel="noopener" href="https://argoproj.github.io/argo-helm/">Argo Helm Charts</a></p>
<p>  通过执行以下任务在集群中安装 Argo CD：</p>
<p>   添加名为 <code>argo</code> 的官方 Argo CD Helm 存储库。</p>
<p>  <strong>注意：Argo CD CRD 已在集群中预安装。</strong></p>
<p>   为 <code>argocd</code> namespace 生成 Argo CD Helm 图表版本 <code>5.5.22</code> 的模板，并将其保存到 <code>~/argo-helm.yaml</code> ，将图表配置为<strong>不</strong>安装 CRDs 。</p>
<p>   使用 Helm 安装 Argo CD ，并设置发布名称为 <code>argocd</code> ，使用与模板中相同的配置和版本（<code>5.5.22</code>） ，将其安装在 <code>argocd</code> namespace 中，并配置为<strong>不</strong>安装 CRDs 。</p>
<p>  <strong>注意：您不需要配置对 Argo CD 服务器 UI 的访问权限。</strong></p>
<p>  <strong>解析</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># 本地加一下Helm库</span>
root@k8s-master:~<span class="token comment"># helm repo add argo https://argoproj.github.io/argo-helm</span>

<span class="token comment"># helm仓库在GitHub上，可能无法连接，使用已有的helm加速，正式考试用题目本身给的链接即可</span>
root@k8s-master:~<span class="token comment"># helm repo add argo https://oss.linuxcenter.cn/files/cka/helm</span>
<span class="token string">"argo"</span> has been added to your repositories

<span class="token comment"># 更新一下仓库信息 考试的时候argo cd的版本未必是固定的哪个版本，这个没关系，按照步骤安装即可</span>
root@k8s-master:~<span class="token comment"># helm repo update</span>
Hang tight <span class="token keyword">while</span> we grab the latest from your chart repositories<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">"argo"</span> chart repository
Update Complete. ⎈Happy Helming<span class="token operator">!</span>⎈

<span class="token comment"># 看看库里的argo cd信息(如果用我的博客，就只有题目要求的一个包)</span>
root@k8s-master:~<span class="token comment"># helm search repo argo</span>
NAME                   CHART VERSION   APP VERSION     DESCRIPTION
argo/argo-cd           <span class="token number">5.5</span>.22          v2.4.14         A Helm chart <span class="token keyword">for</span> Argo CD, a declarative, GitOps<span class="token punctuation">..</span>.
argo/kubernetes-dashboard   <span class="token number">7.13</span>.0                     General-purpose web UI <span class="token keyword">for</span> Kubernetes clusters

<span class="token comment"># 顺便看看argo cd都有哪些版本</span>
root@k8s-master:~<span class="token comment"># helm search repo argo-cd --versions | more</span>
NAME            CHART VERSION   APP VERSION     DESCRIPTION
argo/argo-cd    <span class="token number">5.5</span>.22          v2.4.14         A Helm chart <span class="token keyword">for</span> Argo CD, a declarative, GitOps<span class="token punctuation">..</span>.

<span class="token comment"># 默认情况下，argo cd的crds配置为安装，而题目说的是不安装，需要将install设置为false</span>
root@k8s-master:~<span class="token comment"># helm show values argo/argo-cd | grep -A 8 ^crds</span>
crds:
  <span class="token comment"># -- Install and upgrade CRDs</span>
  install: <span class="token boolean">true</span>
  <span class="token comment"># -- Keep CRDs on chart uninstall</span>
  keep: <span class="token boolean">true</span>
  <span class="token comment"># -- Annotations to be added to all CRDs</span>
  annotations: <span class="token punctuation">{</span><span class="token punctuation">}</span>

global:

<span class="token comment"># 生成模板  这里的参数都来自于helm template -h</span>
root@k8s-master:~<span class="token comment"># helm template argocd argo/argo-cd --namespace argocd --version 5.5.22 --set crds.install=false &gt; ~/argo-helm.yaml</span>

<span class="token comment"># 开始安装</span>
root@k8s-master:~<span class="token comment"># helm install argocd argo/argo-cd --namespace argocd --version 5.5.22 --set crds.install=false</span>
NAME: argocd
LAST DEPLOYED: Thu Aug <span class="token number">28</span> <span class="token number">16</span>:47:08 <span class="token number">2025</span>
NAMESPACE: argocd
STATUS: deployed
REVISION: <span class="token number">1</span>
TEST SUITE: None
NOTES:
In order to access the server UI you have the following options:

<span class="token number">1</span>. kubectl port-forward service/argocd-server <span class="token parameter variable">-n</span> argocd <span class="token number">8080</span>:443

    and <span class="token keyword">then</span> <span class="token function">open</span> the browser on http://localhost:8080 and accept the certificate

<span class="token number">2</span>. <span class="token builtin class-name">enable</span> ingress <span class="token keyword">in</span> the values <span class="token function">file</span> <span class="token variable"><span class="token variable">`</span>server.ingress.enabled<span class="token variable">`</span></span> and either
      - Add the annotation <span class="token keyword">for</span> ssl passthrough: https://github.com/argoproj/argo-cd/blob/master/docs/operator-manual/ingress.md<span class="token comment">#option-1-ssl-passthrough</span>
      - Add the <span class="token variable"><span class="token variable">`</span><span class="token parameter variable">--insecure</span><span class="token variable">`</span></span> flag to <span class="token variable"><span class="token variable">`</span>server.extraArgs<span class="token variable">`</span></span> <span class="token keyword">in</span> the values <span class="token function">file</span> and terminate SSL at your ingress: https://github.com/argoproj/argo-cd/blob/master/docs/operator-manual/ingress.md<span class="token comment">#option-2-multiple-ingress-objects-and-hosts</span>


After reaching the UI the first <span class="token function">time</span> you can login with username: admin and the random password generated during the installation. You can <span class="token function">find</span> the password by running:

kubectl <span class="token parameter variable">-n</span> argocd get secret argocd-initial-admin-secret <span class="token parameter variable">-o</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">"{.data.password}"</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span>

<span class="token punctuation">(</span>You should delete the initial secret afterwards as suggested by the Getting Started Guide: https://github.com/argoproj/argo-cd/blob/master/docs/getting_started.md<span class="token comment">#4-login-using-the-cli)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>验证:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 国内网络情况复杂，不用管pod是什么状态，有这几个pod就行了</span>
root@k8s-master:~<span class="token comment"># kubectl get pod -n argocd</span>
NAME                                                READY   STATUS              RESTARTS   AGE
argocd-application-controller-0                     <span class="token number">1</span>/1     Running             <span class="token number">0</span>          106s
argocd-applicationset-controller-69f65f94d4-qqjqx   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          106s
argocd-dex-server-8496b55dcc-jtsfw                  <span class="token number">0</span>/1     Init:0/1            <span class="token number">0</span>          106s
argocd-notifications-controller-6f68d54df5-tl5jz    <span class="token number">1</span>/1     Running             <span class="token number">0</span>          106s
argocd-redis-5df9769596-xg75q                       <span class="token number">1</span>/1     Running             <span class="token number">0</span>          106s
argocd-repo-server-5d5b6c4466-nm87m                 <span class="token number">0</span>/1     Init:0/1            <span class="token number">0</span>          106s
argocd-server-98cd79c7c-fmmcg                       <span class="token number">1</span>/1     Running             <span class="token number">0</span>          106s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目8-PVC"><a href="#题目8-PVC" class="headerlink" title="题目8: PVC"></a><strong>题目8</strong>: PVC</h1><p>  <code>mariadb</code> namespace 中的 MariaDB Deployment <strong>被误删除</strong>。请恢复该 Deployment 并<strong>确保数据持久性</strong>。请按照以下步骤：</p>
<p>   按照如下规格在 <code>mariadb</code> namespace 中创建名为 <code>mariadb</code> 的 PersistentVolumeClaim (PVC)：</p>
<p>   访问模式为 <code>ReadWriteOnce</code></p>
<p>   存储为 <code>250Mi</code></p>
<p>  集群中现有一个 PersistentVolume，您必须使用现有的 PersistentVolume (PV)</p>
<p>   编辑位于 <code>~/mariadb-deployment.yaml</code> 的 MariaDB Deployment 文件，以使用上一步中创建的 PVC</p>
<p>   将更新的 Deployment 文件应用到集群。</p>
<p>   确保 MariaDB Deployment 正在运行且稳定。</p>
<p>  <strong>查看本题环境准备情况：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get pv</span>
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
mariadb-pv   250Mi      RWO            Retain           Available         <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>                    3d23h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析: 创建pvc</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># 创建一个pvc，用上题目中说的pv</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># vim pvc.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mariadb
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> mariadb
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token string">""</span>  <span class="token comment"># 设置为空，以使用题目要求的PV而不是从默认存储类申请</span>
  <span class="token key atrule">volumeName</span><span class="token punctuation">:</span> mariadb<span class="token punctuation">-</span>pv
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 250Mi
      
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl create -f pvc.yml</span>
persistentvolumeclaim/mariadb created

<span class="token comment"># 确定一下pv和pvc已经成功绑定</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl get pv</span>
NAME         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
mariadb<span class="token punctuation">-</span>pv   250Mi      RWO      Retain     Bound    mariadb/mariadb         &lt;unset<span class="token punctuation">&gt;</span>               4d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析: 创建pvc</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 编辑一下位于 ~/mariadb-deployment.yaml 的 MariaDB Deployment 文件，以使用上一步中创建的pvc</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># vim ~/mariadb-deployment.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mariadb
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> mariadb
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> mariadb
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> mariadb
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mariadb<span class="token punctuation">-</span>storage
          <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
            <span class="token key atrule">claimName</span><span class="token punctuation">:</span> mariadb
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mariadb
        <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/library/mariadb
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MYSQL_ROOT_PASSWORD
          <span class="token key atrule">value</span><span class="token punctuation">:</span> rootpassword
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">999</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">"/var/lib/mysql"</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> mariadb<span class="token punctuation">-</span>storage
            
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl apply -f ~/mariadb-deployment.yaml</span>
deployment.apps/mariadb created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>验证:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get -f ~/mariadb-deployment.yaml</span>
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
mariadb   <span class="token number">0</span>/1     <span class="token number">1</span>            <span class="token number">0</span>           2m12s

<span class="token comment"># 考试时无需关心镜像问题</span>
root@k8s-worker1:~<span class="token comment"># docker pull mariadb</span>
root@k8s-worker2:~<span class="token comment"># docker pull mariadb</span>
root@k8s-worker1:~<span class="token comment"># docker tag mariadb docker.io/library/mariadb</span>
root@k8s-worker2:~<span class="token comment"># docker tag mariadb docker.io/library/mariadb</span>

root@k8s-master:~<span class="token comment"># kubectl get -f ~/mariadb-deployment.yaml</span>
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
mariadb   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           14m
root@k8s-master:~<span class="token comment"># kubectl get pod -n mariadb</span>
NAME                       READY   STATUS    RESTARTS   AGE
mariadb-59dd7c57dc-rj5nv   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16m

root@k8s-master:~<span class="token comment"># kubectl describe deployments.apps -n mariadb | grep -A 5 Volumes:</span>
  Volumes:
   mariadb-storage:
    Type:          PersistentVolumeClaim <span class="token punctuation">(</span>a reference to a PersistentVolumeClaim <span class="token keyword">in</span> the same namespace<span class="token punctuation">)</span>
    ClaimName:     mariadb
    ReadOnly:      <span class="token boolean">false</span>
  Node-Selectors:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目9-Gateway"><a href="#题目9-Gateway" class="headerlink" title="题目9: Gateway"></a><strong>题目9</strong>: Gateway</h1><p>  将现有 Web 应用程序从 Ingress 迁移到 Gateway API。您必须维护 HTTPS 访问权限。</p>
<p>  <strong>注意：集群中安装了一个名为 <code>nginx</code> 的 GatewayClass 。</strong></p>
<p>   首先，创建一个名为 <code>web-gateway</code> 的 Gateway ，主机名为 <code>gateway.linuxcenter.cn</code> ，并保持现有名为 <code>web</code> 的 Ingress 资源的现有 TLS 和侦听器配置。</p>
<p>   接下来，创建一个名为 <code>web-route</code> 的 HTTPRoute ，主机名为 <code>gateway.linuxcenter.cn</code> ，并保持现有名为 <code>web</code> 的 Ingress 资源的现有路由规则。</p>
<p>   您可以使用以下命令测试 Gateway API 配置：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># curl -Lk https://gateway.linuxcenter.cn</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  最后，删除名为 <code>web</code> 的现有 Ingress 资源。</p>
<p>  <strong>查看本题环境准备情况：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get gatewayclasses.gateway.networking.k8s.io</span>
NAME    CONTROLLER                                   ACCEPTED   AGE
nginx   gateway.nginx.org/nginx-gateway-controller   True       4d

root@k8s-master:~<span class="token comment"># kubectl get ingress</span>
NAME   CLASS   HOSTS                    ADDRESS                   PORTS     AGE
web    nginx   ingress.linuxcenter.cn   <span class="token number">192.168</span>.8.4,192.168.8.5   <span class="token number">80</span>, <span class="token number">443</span>   4d

root@k8s-master:~<span class="token comment"># kubectl describe ingress web</span>
Name:             web
Labels:           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Namespace:        default
Address:          <span class="token number">192.168</span>.8.4,192.168.8.5
Ingress Class:    nginx
Default backend:  <span class="token operator">&lt;</span>default<span class="token operator">&gt;</span>
TLS:
  web-cert terminates ingress.linuxcenter.cn
Rules:
  Host                    Path  Backends
  ----                    ----  --------
  ingress.linuxcenter.cn
                          /   web:80 <span class="token punctuation">(</span><span class="token number">172.16</span>.194.83:80<span class="token punctuation">)</span>
Annotations:              nginx.ingress.kubernetes.io/rewrite-target: /
Events:
  Type    Reason  Age                From                      Message
  ----    ------  ----               ----                      -------
  Normal  Sync    17m <span class="token punctuation">(</span>x3 over 4d<span class="token punctuation">)</span>   nginx-ingress-controller  Scheduled <span class="token keyword">for</span> <span class="token function">sync</span>
  Normal  Sync    16m <span class="token punctuation">(</span>x3 over 17m<span class="token punctuation">)</span>  nginx-ingress-controller  Scheduled <span class="token keyword">for</span> <span class="token function">sync</span>
  Normal  Sync    16m                nginx-ingress-controller  Scheduled <span class="token keyword">for</span> <span class="token function">sync</span>
  
<span class="token comment"># 看看它的ingress是否可以访问</span>
root@k8s-master:~<span class="token comment"># curl -kL http://ingress.linuxcenter.cn</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析-创建Gateway:</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ssh root@k8s-master</span>

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># vim gateway.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> gateway.networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Gateway
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web<span class="token punctuation">-</span>gateway
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">gatewayClassName</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">listeners</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> https
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> HTTPS
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">hostname</span><span class="token punctuation">:</span> gateway.linuxcenter.cn
      <span class="token key atrule">tls</span><span class="token punctuation">:</span>
        <span class="token key atrule">certificateRefs</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
            <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">""</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> web<span class="token punctuation">-</span>cert
                    
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl create -f gateway.yml</span>
gateway.gateway.networking.k8s.io/web<span class="token punctuation">-</span>gateway created

root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl describe -f gateway.yml</span>
<span class="token punctuation">...</span><span class="token punctuation">...</span>
  <span class="token key atrule">Gateway Class Name</span><span class="token punctuation">:</span>  nginx
  <span class="token key atrule">Listeners</span><span class="token punctuation">:</span>
    <span class="token key atrule">Allowed Routes</span><span class="token punctuation">:</span>
      <span class="token key atrule">Namespaces</span><span class="token punctuation">:</span>
        <span class="token key atrule">From</span><span class="token punctuation">:</span>  Same
    <span class="token key atrule">Hostname</span><span class="token punctuation">:</span>  gateway.linuxcenter.cn
    <span class="token key atrule">Name</span><span class="token punctuation">:</span>      web
    <span class="token key atrule">Port</span><span class="token punctuation">:</span>      <span class="token number">443</span>
    <span class="token key atrule">Protocol</span><span class="token punctuation">:</span>  HTTPS
    <span class="token key atrule">Tls</span><span class="token punctuation">:</span>
      <span class="token key atrule">Certificate Refs</span><span class="token punctuation">:</span>
        <span class="token key atrule">Group</span><span class="token punctuation">:</span>
        <span class="token key atrule">Kind</span><span class="token punctuation">:</span>   Secret
        <span class="token key atrule">Name</span><span class="token punctuation">:</span>   web<span class="token punctuation">-</span>cert
      <span class="token key atrule">Mode</span><span class="token punctuation">:</span>     Terminate
<span class="token punctuation">...</span><span class="token punctuation">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析: 创建HTTPRoute</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># vim httproute.yml</span>
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: web-route
spec:
  parentRefs:
    - name: web-gateway
  hostnames:
    - <span class="token string">"gateway.linuxcenter.cn"</span>
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: web
          port: <span class="token number">80</span>

root@k8s-master:~<span class="token comment"># kubectl create -f httproute.yml</span>
httproute.gateway.networking.k8s.io/web-route created

root@k8s-master:~<span class="token comment"># kubectl get httproutes.gateway.networking.k8s.io</span>
NAME        HOSTNAMES                    AGE
web-route   <span class="token punctuation">[</span><span class="token string">"gateway.linuxcenter.cn"</span><span class="token punctuation">]</span>   51s

<span class="token comment"># 测试一下能不能访问</span>
root@k8s-master:~<span class="token comment"># curl -kL https://gateway.linuxcenter.cn</span>

<span class="token comment"># 最后删除 web ingress</span>
root@k8s-master:~<span class="token comment"># kubectl delete ingress web</span>
ingress.networking.k8s.io <span class="token string">"web"</span> deleted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目10-network-policy"><a href="#题目10-network-policy" class="headerlink" title="题目10: network policy"></a><strong>题目10</strong>: network policy</h1><p>  从提供的 YAML 样本中查看并应用适当的 NetworkPolicy。</p>
<p>   确保选择的 NetworkPolicy 不过于宽松，同时允许运行在 frontend 和 backend namespaces 中的 <code>frontend</code> 和 <code>backend</code> Deployment 之间的通信。</p>
<p>   首先，分析 <code>frontend</code> 和 <code>backend</code> Deployment，以确定需要应用的 NetworkPolicy 的具体要求。</p>
<p>   接下来，检查位于 <code>~/networkpolicy</code> 文件夹中的 NetworkPolicy YAML 示例。</p>
<p>  <strong>注意：请勿删除或修改提供的示例。仅应用其中一个。否则可能会导致分数降低。</strong></p>
<p>   最后，应用启用 <code>frontend</code> 和 <code>backend</code> Deployment 之间的通信的 NetworkPolicy，但不要过于宽容。</p>
<p>  <strong>注意：请勿删除或修改现有的默认拒绝所有入站流量或出口流量 NetworkPolicy。否则可能导致零分。</strong></p>
<p>  <strong>查看本题环境准备情况：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 根据题目，先看看这两个deployment里的pod，有没有什么可以被网络策略选中的特征</span>
<span class="token comment"># 看完之后，发现必须用app这个标签来做pod的允许</span>
root@k8s-master:~<span class="token comment"># kubectl get namespaces --show-labels | grep -E "backend|fronted"</span>
backend              Active   4d13h   kubernetes.io/metadata.name<span class="token operator">=</span>backend

root@k8s-master:~<span class="token comment"># kubectl get pod -n frontend --show-labels</span>
NAME                        READY   STATUS    RESTARTS      AGE     LABELS
frontend-6546f6985b-lpkmd   <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>13h ago<span class="token punctuation">)</span>   4d13h   <span class="token assign-left variable">app</span><span class="token operator">=</span>frontend,pod-template-hash<span class="token operator">=</span>6546f6985b

root@k8s-master:~<span class="token comment"># kubectl get pod -n backend --show-labels</span>
NAME                       READY   STATUS    RESTARTS      AGE     LABELS
backend-5c687b8b4b-5lp5x   <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>13h ago<span class="token punctuation">)</span>   4d13h   <span class="token assign-left variable">app</span><span class="token operator">=</span>backend,pod-template-hash<span class="token operator">=</span>5c687b8b4b

<span class="token comment"># 看完了pod，再看看题目里说的默认策略</span>
<span class="token comment"># 这个策略还是很严格的，所有pod都被隔离了，但是题目说不让我们动，我们看看就行</span>

root@k8s-master:~<span class="token comment"># kubectl get networkpolicies.networking.k8s.io -n frontend</span>
No resources found <span class="token keyword">in</span> frontend namespace.

root@k8s-master:~<span class="token comment"># kubectl get networkpolicies.networking.k8s.io -n backend</span>
NAME       POD-SELECTOR   AGE
deny-all   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         4d13h

root@k8s-master:~<span class="token comment"># kubectl describe networkpolicies deny-all -n backend</span>
Name:         deny-all
Namespace:    backend
Created on:   <span class="token number">2025</span>-08-24 <span class="token number">20</span>:27:31 +0800 CST
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Spec:
  PodSelector:     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span> <span class="token punctuation">(</span>Allowing the specific traffic to all pods <span class="token keyword">in</span> this namespace<span class="token punctuation">)</span>
  Allowing ingress traffic:
    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span> <span class="token punctuation">(</span>Selected pods are isolated <span class="token keyword">for</span> ingress connectivity<span class="token punctuation">)</span>
  Not affecting egress traffic
  Policy Types: Ingress<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析</strong>:</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># 再根据题目分析位于 ~/networkpolicy 文件夹中的 NetworkPolicy YAML 示例，分析完选一个正好合适且不宽松的策略</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># ls ~/networkpolicy/</span>
policy1.yaml  policy2.yaml  policy3.yaml

<span class="token comment"># 看看第一个，这个看完之后感觉podSelector的范围太大了，不适合仅用于这两个pod之间的通信</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># cd networkpolicy/</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span>~/networkpolicy<span class="token comment"># cat policy1.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> NetworkPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> policy1
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> backend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">podSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">policyTypes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Ingress
  <span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">namespaceSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
          <span class="token key atrule">kubernetes.io/metadata.name</span><span class="token punctuation">:</span> frontend

<span class="token comment"># 再看看第二个，这个还行，在backend的ns中，只允许frontend的ns里具有app: frontend标签的pod来连接backend的ns里的app: backend标签的pod</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span>~/networkpolicy<span class="token comment"># cat policy2.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> NetworkPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> policy2
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> backend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">podSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> backend
  <span class="token key atrule">policyTypes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Ingress
  <span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">namespaceSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
          <span class="token key atrule">kubernetes.io/metadata.name</span><span class="token punctuation">:</span> frontend
    <span class="token punctuation">-</span> <span class="token key atrule">podSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
          <span class="token key atrule">app</span><span class="token punctuation">:</span> frontend
          
<span class="token comment"># 再看看第三个，第三个看上去和我们没啥关系，我们没用这个IP段，而且在backend的ns中，也没有database标签的pod</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span>~/networkpolicy<span class="token comment"># cat policy3.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> NetworkPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> policy3
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> backend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">podSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> database
  <span class="token key atrule">policyTypes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Ingress
  <span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">namespaceSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
          <span class="token key atrule">kubernetes.io/metadata.name</span><span class="token punctuation">:</span> frontend
      <span class="token key atrule">podSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
          <span class="token key atrule">app</span><span class="token punctuation">:</span> frontend
    <span class="token punctuation">-</span> <span class="token key atrule">ipBlock</span><span class="token punctuation">:</span>
        <span class="token key atrule">cidr</span><span class="token punctuation">:</span> 10.0.0.0/24
<span class="token comment"># 综合分析之下，第二个policy比较合适，不过于宽松，又刚好合适，直接apply即可</span>
root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl apply -f ~/networkpolicy/policy2.yaml</span>
networkpolicy.networking.k8s.io/policy2 created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目11-CRD"><a href="#题目11-CRD" class="headerlink" title="题目11: CRD"></a><strong>题目11</strong>: CRD</h1><p>  验证已部署到<code>cert-manager</code>命名空间中的 <code>cert-manager</code> 应用程序。</p>
<p>  使用 <code>kubectl</code> ，将 <code>cert-manager</code> 所有定制资源定义（CRD）的列表，保存到 <code>~/resources.yaml</code> 。</p>
<p>  <strong>注意：您必须使用 kubectl 的默认输出格式。请勿设置输出格式。否则将导致分数降低。</strong></p>
<p>  使用 <code>kubectl</code> ，提取crd资源中<code>Certificate</code> 资源类型里<code>spec</code>下面的 <code>subject</code> 字段的文档，并将其保存到 <code>~/subject.yaml</code> 。</p>
<p>  <strong>注意：您可以使用 kubectl 支持的任何输出格式。如果不确定，请使用默认输出格式。</strong></p>
<p>  <strong>查看本题环境准备情况：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 先看看题目说的应用程序有没有</span>
root@k8s-master:~<span class="token comment"># kubectl get pod -n cert-manager</span>
NAME                                       READY   STATUS    RESTARTS      AGE
cert-manager-7979fbf6b6-6cp85              <span class="token number">1</span>/1     Running   <span class="token number">2</span> <span class="token punctuation">(</span>13h ago<span class="token punctuation">)</span>   4d14h
cert-manager-cainjector-68b64d44c7-tnx72   <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>13h ago<span class="token punctuation">)</span>   4d14h
cert-manager-webhook-ff897cd5d-dfpzd       <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>13h ago<span class="token punctuation">)</span>   4d14h

root@k8s-master:~<span class="token comment"># kubectl get deployments.apps -n cert-manager</span>
NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
cert-manager              <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           4d14h
cert-manager-cainjector   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           4d14h
cert-manager-webhook      <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           4d14h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析:</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># 看看它有哪些crd，然后按照题目保存起来</span>
root@k8s-master:~<span class="token comment"># kubectl get crd | grep cert-manager</span>
certificaterequests.cert-manager.io                     <span class="token number">2025</span>-08-24T12:27:39Z
certificates.cert-manager.io                            <span class="token number">2025</span>-08-24T12:27:39Z
challenges.acme.cert-manager.io                         <span class="token number">2025</span>-08-24T12:27:39Z
clusterissuers.cert-manager.io                          <span class="token number">2025</span>-08-24T12:27:39Z
issuers.cert-manager.io                                 <span class="token number">2025</span>-08-24T12:27:39Z
orders.acme.cert-manager.io                             <span class="token number">2025</span>-08-24T12:27:39Z

root@k8s-master:~<span class="token comment"># kubectl get crd | grep cert-manager &gt; ~/resources.yaml</span>
root@k8s-master:~<span class="token comment"># cat resources.yaml</span>

<span class="token comment"># 获取一下题目要求的spec下面的subject字段，然后保存就行</span>
root@k8s-master:~<span class="token comment"># kubectl explain certificate.spec.subject</span>
GROUP:      cert-manager.io
KIND:       Certificate
VERSION:    v1

FIELD: subject <span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span>


DESCRIPTION:
    Requested <span class="token builtin class-name">set</span> of X509 certificate subject attributes.
    More info: https://datatracker.ietf.org/doc/html/rfc5280<span class="token comment">#section-4.1.2.6</span>

    The common name attribute is specified separately <span class="token keyword">in</span> the <span class="token variable"><span class="token variable">`</span>commonName<span class="token variable">`</span></span> field.
    Cannot be <span class="token builtin class-name">set</span> <span class="token keyword">if</span> the <span class="token variable"><span class="token variable">`</span>literalSubject<span class="token variable">`</span></span> field is set.

FIELDS:
  countries     <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
    Countries to be used on the Certificate.

  localities    <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
    Cities to be used on the Certificate.

  organizationalUnits   <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
    Organizational Units to be used on the Certificate.

  organizations <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
    Organizations to be used on the Certificate.

  postalCodes   <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
    Postal codes to be used on the Certificate.

  provinces     <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
    State/Provinces to be used on the Certificate.

  serialNumber  <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
    Serial number to be used on the Certificate.

  streetAddresses       <span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>string<span class="token operator">&gt;</span>
    Street addresses to be used on the Certificate.

root@k8s-master:~<span class="token comment"># kubectl explain certificate.spec.subject &gt; ~/subject.yaml</span>
root@k8s-master:~<span class="token comment"># cat subject.yaml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目12-ConfigMap"><a href="#题目12-ConfigMap" class="headerlink" title="题目12: ConfigMap"></a><strong>题目12</strong>: ConfigMap</h1><p>  名为 <code>nginx-static</code> 的 Deployment 正运行于 <code>nginx-static</code> 命名空间，并通过 <code>nginx-config</code> ConfigMap 进行配置。</p>
<p>  更新 <code>nginx-config</code> ConfigMap 以仅允许 TLSv1.3 连接。</p>
<p>  <strong>注意：您可以根据需要重新创建、重新启动或扩展资源。</strong></p>
<p>  您可以使用以下命令测试更改:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># curl -k --tls-max 1.3 https://ssl.linuxcenter.cn</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>查看本题环境准备情况：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get deployments.apps -n nginx-static</span>
NAME           READY   UP-TO-DATE   AVAILABLE   AGE
nginx-static   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           4d14h

root@k8s-master:~<span class="token comment"># kubectl get deployments.apps -n nginx-static -o yaml</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
        volumes:
        - configMap:
            defaultMode: <span class="token number">420</span>
            name: nginx-tls
          name: tls
        - configMap:
            defaultMode: <span class="token number">420</span>
            name: nginx-config
          name: config
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

root@k8s-master:~<span class="token comment"># kubectl describe configmaps -n nginx-static nginx-config</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
server <span class="token punctuation">{</span>
  listen <span class="token number">443</span> ssl default_server<span class="token punctuation">;</span>
  server_name ssl.linuxcenter.cn<span class="token punctuation">;</span>

  ssl_certificate /etc/nginx/ssl/tls.crt<span class="token punctuation">;</span>
  ssl_certificate_key /etc/nginx/ssl/tls.key<span class="token punctuation">;</span>
  ssl_prefer_server_ciphers on<span class="token punctuation">;</span>
  ssl_protocols TLSv1.2 TLSv1.3<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
    root   /usr/share/nginx/html<span class="token punctuation">;</span>
    index  index.html index.htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># configmap这个东西不方便直接edit，所以我们先导出来一份，然后改改，再给他重新创建就行</span>
root@k8s-master:~<span class="token comment"># kubectl get configmaps -n nginx-static nginx-config -o yaml &gt; configmap.yml</span>

<span class="token comment"># 把里面的ssl_protocols参数只留下TLSv1.3</span>
root@k8s-master:~<span class="token comment"># vim configmap.yml</span>
apiVersion: v1
data:
  default.conf: <span class="token operator">|</span>
    server <span class="token punctuation">{</span>
      listen <span class="token number">443</span> ssl default_server<span class="token punctuation">;</span>
      server_name ssl.linuxcenter.cn<span class="token punctuation">;</span>

      ssl_certificate /etc/nginx/ssl/tls.crt<span class="token punctuation">;</span>
      ssl_certificate_key /etc/nginx/ssl/tls.key<span class="token punctuation">;</span>
      ssl_prefer_server_ciphers on<span class="token punctuation">;</span>
      ssl_protocols TLSv1.3<span class="token punctuation">;</span>   <span class="token comment"># 改这里，只留下TLSv1.3</span>
      location / <span class="token punctuation">{</span>
        root   /usr/share/nginx/html<span class="token punctuation">;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

root@k8s-master:~<span class="token comment"># kubectl delete configmaps -n nginx-static nginx-config</span>
configmap <span class="token string">"nginx-config"</span> deleted

root@k8s-master:~<span class="token comment"># kubectl apply -f configmap.yml</span>
configmap/nginx-config created
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>验证</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 重新创建configmap后，发现configmap就只有TLSv1.3了</span>
root@k8s-master:~<span class="token comment"># kubectl describe configmaps -n nginx-static nginx-config</span>
Name:         nginx-config
Namespace:    nginx-static
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

Data
<span class="token operator">==</span><span class="token operator">==</span>
default.conf:
----
server <span class="token punctuation">{</span>
  listen <span class="token number">443</span> ssl default_server<span class="token punctuation">;</span>
  server_name ssl.linuxcenter.cn<span class="token punctuation">;</span>

  ssl_certificate /etc/nginx/ssl/tls.crt<span class="token punctuation">;</span>
  ssl_certificate_key /etc/nginx/ssl/tls.key<span class="token punctuation">;</span>
  ssl_prefer_server_ciphers on<span class="token punctuation">;</span>
  ssl_protocols TLSv1.3<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
    root   /usr/share/nginx/html<span class="token punctuation">;</span>
    index  index.html index.htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>重新推出deployment的新版本，测试是否只支持TLSv1.3</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl rollout restart deployment -n nginx-static nginx-static</span>
deployment.apps/nginx-static restarted

root@k8s-master:~<span class="token comment"># curl -k --tls-max 1.3 https://ssl.linuxcenter.cn</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>

root@k8s-master:~<span class="token comment"># curl -k --tls-max 1.2 https://ssl.linuxcenter.cn</span>
curl: <span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span> OpenSSL/3.0.13: error:0A00042E:SSL routines::tlsv1 alert protocol version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目13-resources"><a href="#题目13-resources" class="headerlink" title="题目13: resources"></a>题目13: resources</h1><p>  您管理一个 WordPress 应用程序。由于资源请求过高，某些 Pod 无法启动。</p>
<p>  <strong>Task:</strong></p>
<p>  <code>relative-fawn</code> namespace 中的 WordPress 应用程序包含：</p>
<p>   具有 <code>3</code> 个副本的 WordPress Deployment</p>
<p>  按如下方式调整所有 Pod 资源请求：</p>
<p>   将节点资源平均分配给这 <code>3</code> 个 Pod</p>
<p>   为每个 Pod 分配公平的 <code>CPU 和内存</code>份额</p>
<p>   添加足够的开销以保持节点稳定</p>
<p>  请确保，对容器和初始化容器使用完全相同的请求。</p>
<p>  您无需更改任何资源限制。</p>
<p>  在更新资源请求时，暂时将 WordPress Deployment 缩放为 0 个副本可能会有所帮助。</p>
<p>  更新后，请确认：</p>
<p>   WordPress 保持 <code>3</code> 个副本</p>
<p>   所有 Pod 都在运行并准备就绪</p>
<p>  <strong>查看本题环境准备情况：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># kubectl get deployments.apps -n relative-fawn</span>
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
wordpress   <span class="token number">0</span>/3     <span class="token number">3</span>            <span class="token number">0</span>           4d18h

root@k8s-master:~<span class="token comment"># kubectl get pod -n relative-fawn</span>
NAME                         READY   STATUS    RESTARTS   AGE
wordpress-5c56f7fd5c-2v5hm   <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          4d18h
wordpress-5c56f7fd5c-4ht2p   <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          4d18h
wordpress-5c56f7fd5c-lcccn   <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          4d18h

<span class="token comment"># 预期节点是k8s-worker1，不过不用纠结是哪个节点，考试的时候，这个题目所在的集群一共就只有一个节点</span>
root@k8s-master:~<span class="token comment"># kubectl describe deployments.apps -n relative-fawn wordpress</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
  Node-Selectors:  kubernetes.io/hostname<span class="token operator">=</span>k8s-worker1
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>分析</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># 看看为啥起不来</span>
<span class="token comment"># 是因为没有足够的CPU和内存的原因，和题目说的一样，题目要求均分这个节点资源，我们在模拟的时候，你自己的电脑性能有限，不能部署单独的节点，模拟一下就行，不过你要会算</span>

root@k8s-master:~<span class="token comment"># kubectl get pod -n relative-fawn -o yaml</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
    conditions:
    - lastProbeTime: null
      lastTransitionTime: <span class="token string">"2025-08-24T12:30:07Z"</span>
      message: <span class="token string">'0/3 nodes are available: 1 Insufficient cpu, 1 Insufficient memory,

root@k8s-master:~# kubectl describe pod -n relative-fawn wordpress-5c56f7fd5c-2v5hm
......
Events:
  Type     Reason            Age                    From               Message
  ----     ------            ----                   ----               -------
  Warning  FailedScheduling  10m (x523 over 4d18h)  default-scheduler  0/3 nodes are available: 1 Insufficient cpu, 1 Insufficient memory, 1 node(s) didn'</span>t match Pod's <span class="token function">node</span> affinity/selector, <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> had untolerated taint <span class="token punctuation">{</span>node-role.kubernetes.io/control-plane: <span class="token punctuation">}</span>. preemption: <span class="token number">0</span>/3 nodes are available: <span class="token number">1</span> No preemption victims found <span class="token keyword">for</span> incoming pod, <span class="token number">2</span> Preemption is not helpful <span class="token keyword">for</span> scheduling.

<span class="token comment"># 先去到目标节点上看看有多少内存</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-worker1</span>

<span class="token comment"># 我们的节点一共有这么多资源</span>
root@k8s-worker1:~<span class="token comment"># lsmem</span>
RANGE                                 SIZE  STATE REMOVABLE BLOCK
0x0000000000000000-0x000000007fffffff   2G online       <span class="token function">yes</span>  <span class="token number">0</span>-15

Memory block size:       128M
Total online memory:       2G
Total offline memory:      0B

root@k8s-worker1:~<span class="token comment"># ls cpu</span>

<span class="token comment"># 或者在master上这么看</span>
root@k8s-master:~<span class="token comment"># kubectl describe node k8s-worker1</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Allocatable:
  cpu:                <span class="token number">2</span>
  ephemeral-storage:  <span class="token number">94580335255</span>
  hugepages-1Gi:      <span class="token number">0</span>
  hugepages-2Mi:      <span class="token number">0</span>
  memory:             1863712Ki
  pods:               <span class="token number">110</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

<span class="token comment"># 回到master上看看已分配了多少，就能算出来还剩多少</span>
root@k8s-master:~<span class="token comment"># kubectl describe node k8s-worker1</span>
Allocated resources:
  <span class="token punctuation">(</span>Total limits may be over <span class="token number">100</span> percent, i.e., overcommitted.<span class="token punctuation">)</span>
  Resource           Requests     Limits
  --------           --------     ------
  cpu                200m <span class="token punctuation">(</span><span class="token number">10</span>%<span class="token punctuation">)</span>   <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>
  memory             290Mi <span class="token punctuation">(</span><span class="token number">15</span>%<span class="token punctuation">)</span>  <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>
  ephemeral-storage  <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>       <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>
  hugepages-1Gi      <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>       <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>
  hugepages-2Mi      <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>       <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

<span class="token comment"># 看来我们有2个CPU，2G内存</span>
<span class="token comment"># 你以当时的情况为准，比如说我这个内存占了90Mi，那就还剩下2048Mi-90Mi=1958Mi内存，CPU的话我这个占用了100m，那就还剩下2000m-100=1900m</span>
<span class="token comment"># 现在来算账，一共有几个容器，然后除一下，就知道了</span>
<span class="token comment"># 来看看deployment里有几个容器，从下面的信息来看，一个deployment里，有一个init，有一个普通的容器，一共3个副本的话，那就是6个容器</span>

root@k8s-master:~<span class="token comment"># kubectl describe deployments.apps -n relative-fawn wordpress</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Pod Template:
  Labels:  <span class="token assign-left variable">app</span><span class="token operator">=</span>wordpress
  Init Containers:
   initcontainer:
    Image:      docker.io/library/busybox
    Port:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Host Port:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Command:
      <span class="token function">sh</span>
      <span class="token parameter variable">-c</span>
      <span class="token builtin class-name">echo</span> <span class="token string">"Initializing..."</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">10</span>
    Limits:
      cpu:        2500m
      memory:     2600Mi
    Environment:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Mounts:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
  Containers:
   wordpress:
    Image:      docker.io/library/nginx
    Port:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Host Port:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Limits:
      cpu:         2500m
      memory:      2600Mi
    Environment:   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Mounts:        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
  Volumes:         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
  Node-Selectors:  kubernetes.io/hostname<span class="token operator">=</span>k8s-worker1
  Tolerations:     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
 
 来除一下：
<span class="token number">1</span>.CPU: <span class="token number">1900</span>/6<span class="token operator">=</span>316m
<span class="token number">2</span>.memory：1958/6<span class="token operator">=</span>326Mi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 完之后，更新一下deployment即可，不过需要注意，不要太老实，你的电脑性能有限，我们这里就用100Mi内存和0.1cpu代替，考试的时候，按照你算的为准，模拟考试要求按照下面的步骤设置</span>
root@k8s-master:~<span class="token comment"># kubectl -n relative-fawn set resources deployment wordpress --requests 'cpu=0.1,memory=100Mi'</span>
deployment.apps/wordpress resource requirements updated

<span class="token comment"># 重新推出deployment，看看能不能启动</span>
root@k8s-master:~<span class="token comment"># kubectl rollout restart deployment -n relative-fawn wordpress</span>
deployment.apps/wordpress restarted

root@k8s-master:~<span class="token comment"># kubectl get pod -n relative-fawn</span>
NAME                         READY   STATUS    RESTARTS   AGE
wordpress-7dc57b5fd7-9mjl9   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          77s
wordpress-7dc57b5fd7-h6bgp   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          65s
wordpress-7dc57b5fd7-hghb2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          53s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目14-cri-dockerd"><a href="#题目14-cri-dockerd" class="headerlink" title="题目14: cri-dockerd"></a><strong>题目14</strong>: cri-dockerd</h1><p>  您必须连接到<code>k8s-worker2</code>主机。不这样做可能导致零分。</p>
<p>  <strong>Context</strong></p>
<p>  您的任务是为 Kubernetes 准备一个 Linux 系统。 Docker 已被安装，但您需要为 kubeadm 配置它。</p>
<p>  <strong>Task</strong></p>
<p>  完成以下任务，为 Kubernetes 准备系统：</p>
<p>  设置 <code>cri-dockerd</code> ：</p>
<p>   安装 Debian 软件包 <code>~/cri-dockerd_0.3.20.3-0.ubuntu-jammy_amd64.deb</code> Debian 软件包使用 dpkg 安装。</p>
<p>   启用并启动 cri-docker 服务</p>
<p>  配置以下系统参数:</p>
<p>    <code>net.bridge.bridge-nf-call-iptables</code> 设置为 <code>1</code></p>
<p>    <code>net.ipv6.conf.all.forwarding</code> 设置为 <code>1</code></p>
<p>    <code>net.ipv4.ip_forward</code> 设置为 <code>1</code></p>
<p>    <code>net.netfilter.nf_conntrack_max</code> 设置为 <code>131072</code></p>
<p>  确保这些系统参数在系统重启后仍然存在，并应用于正在运行的系统。</p>
<p>  <strong>查看本题环境准备情况：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 先看看现在的版本</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-worker2</span>
root@k8s-worker2:~<span class="token comment"># sudo cri-dockerd --version</span>
cri-dockerd <span class="token number">0.3</span>.17 <span class="token punctuation">(</span>483e3b6<span class="token punctuation">)</span>

<span class="token comment"># 再看看我们有没有预期的文件</span>
root@k8s-worker2:~<span class="token comment"># ls</span>
cri-dockerd_0.3.18.3-0.ubuntu-jammy_amd64.deb  readme.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>解析</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 考试的时候看题目让你怎么ssh，如果ssh上来不是root，就需要sudo -i，或者命令前面加sudo进行授权</span>
root@k8s-worker2:~<span class="token comment"># ls</span>
cri-dockerd_0.3.18.3-0.ubuntu-jammy_amd64.deb  readme.txt

root@k8s-worker2:~<span class="token comment"># sudo dpkg -i cri-dockerd_0.3.18.3-0.ubuntu-jammy_amd64.deb</span>

<span class="token comment"># 再看看版本</span>
root@k8s-worker2:~<span class="token comment"># sudo cri-dockerd --version</span>
cri-dockerd <span class="token number">0.3</span>.18 <span class="token punctuation">(</span>5709af9<span class="token punctuation">)</span>

<span class="token comment"># 启用并启动cri-docker服务</span>
root@k8s-worker2:~<span class="token comment"># sudo systemctl daemon-reload</span>
root@k8s-worker2:~<span class="token comment"># sudo systemctl enable cri-docker</span>
root@k8s-worker2:~<span class="token comment"># sudo systemctl restart cri-docker</span>
root@k8s-worker2:~<span class="token comment"># sudo systemctl status cri-docker</span>
● cri-docker.service - CRI Interface <span class="token keyword">for</span> Docker Application Container Engine
     Loaded: loaded <span class="token punctuation">(</span>/etc/systemd/system/cri-docker.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> preset: enabled<span class="token punctuation">)</span>
     Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Fri <span class="token number">2025</span>-08-29 <span class="token number">15</span>:49:26 CST<span class="token punctuation">;</span> 9s ago
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

<span class="token comment"># 服务升级搞定，现在来配一下系统参数，如果你没有sudo -i成root，就需要加sudo命令提升权限，不然无法保存</span>
root@k8s-worker2:~<span class="token comment"># sudo vim /etc/sysctl.d/cka.conf</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv6.conf.all.forwarding <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>
net.netfilter.nf_conntrack_max <span class="token operator">=</span> <span class="token number">131072</span>

<span class="token comment"># 用下面的命令让它立刻生效</span>
root@k8s-worker2:~<span class="token comment"># sudo sysctl --system</span>

<span class="token comment"># 检查</span>
root@k8s-worker2:~<span class="token comment"># sudo sysctl net.bridge.bridge-nf-call-iptables</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>

root@k8s-worker2:~<span class="token comment"># sudo sysctl net.ipv6.conf.all.forwarding</span>
net.ipv6.conf.all.forwarding <span class="token operator">=</span> <span class="token number">1</span>

root@k8s-worker2:~<span class="token comment"># sudo sysctl net.ipv4.ip_forward</span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>

root@k8s-worker2:~<span class="token comment"># sudo sysctl net.netfilter.nf_conntrack_max</span>
net.netfilter.nf_conntrack_max <span class="token operator">=</span> <span class="token number">131072</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目15-etcd"><a href="#题目15-etcd" class="headerlink" title="题目15: etcd"></a><strong>题目15</strong>: etcd</h1><p>  您必须连接到正确的主机。不这样做可能导致零分。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># ssh root@k8s-standalone</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>Context</strong></p>
<p>   <code>kubeadm</code> 配置的集群已迁移到新机器。它需要更改配置才能成功运行。</p>
<p>  <strong>Task</strong></p>
<p>   修复在机器迁移过程中损坏的单节点集群。</p>
<p>   首先，确定损坏的集群组件，并调查导致其损坏的原因。</p>
<p>   注意：已停用的集群使用外部 etcd 服务器。</p>
<p>   接下来，修复所有损坏的集群组件的配置。</p>
<p>   注意：确保重新启动所有必要的服务和组件，以使更改生效。否则可能导致分数降低。</p>
<p>   最后，确保集群运行正常。确保：每个节点 和 所有 Pod 都处于 Ready 状态。</p>
<p>  <strong>解析</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># 考试的时候看题目让你怎么ssh，如果ssh上来不是root，就需要sudo -i，或者命令前面加sudo进行授权</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-standalone</span>

<span class="token comment"># 看看是否能获取集群信息</span>

root@k8s-standalone:~<span class="token comment"># kubectl get nodes</span>
E0829 <span class="token number">16</span>:05:59.114692  <span class="token number">112032</span> memcache.go:265<span class="token punctuation">]</span> <span class="token string">"Unhandled Error"</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">"couldn't get current server API group list: Get <span class="token entity" title="\&quot;">\"</span>https://192.168.8.6:6443/api?timeout=32s<span class="token entity" title="\&quot;">\"</span>: dial tcp 192.168.8.6:6443: connect: connection refused"</span>
E0829 <span class="token number">16</span>:05:59.116590  <span class="token number">112032</span> memcache.go:265<span class="token punctuation">]</span> <span class="token string">"Unhandled Error"</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">"couldn't get current server API group list: Get <span class="token entity" title="\&quot;">\"</span>https://192.168.8.6:6443/api?timeout=32s<span class="token entity" title="\&quot;">\"</span>: dial tcp 192.168.8.6:6443: connect: connection refused"</span>
E0829 <span class="token number">16</span>:05:59.118419  <span class="token number">112032</span> memcache.go:265<span class="token punctuation">]</span> <span class="token string">"Unhandled Error"</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">"couldn't get current server API group list: Get <span class="token entity" title="\&quot;">\"</span>https://192.168.8.6:6443/api?timeout=32s<span class="token entity" title="\&quot;">\"</span>: dial tcp 192.168.8.6:6443: connect: connection refused"</span>
E0829 <span class="token number">16</span>:05:59.119941  <span class="token number">112032</span> memcache.go:265<span class="token punctuation">]</span> <span class="token string">"Unhandled Error"</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">"couldn't get current server API group list: Get <span class="token entity" title="\&quot;">\"</span>https://192.168.8.6:6443/api?timeout=32s<span class="token entity" title="\&quot;">\"</span>: dial tcp 192.168.8.6:6443: connect: connection refused"</span>
E0829 <span class="token number">16</span>:05:59.121723  <span class="token number">112032</span> memcache.go:265<span class="token punctuation">]</span> <span class="token string">"Unhandled Error"</span> <span class="token assign-left variable">err</span><span class="token operator">=</span><span class="token string">"couldn't get current server API group list: Get <span class="token entity" title="\&quot;">\"</span>https://192.168.8.6:6443/api?timeout=32s<span class="token entity" title="\&quot;">\"</span>: dial tcp 192.168.8.6:6443: connect: connection refused"</span>
The connection to the server <span class="token number">192.168</span>.8.6:6443 was refused - did you specify the right <span class="token function">host</span> or port?

<span class="token comment"># 已经连不上了，但是看它返回的192.168.8.6:6443又是对的，这个说明我们的~/.kube/config没问题，那我们看看静态pod配置文件</span>
root@k8s-standalone:~<span class="token comment"># cd /etc/kubernetes/manifests/</span>
root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># ls</span>
etcd.yaml  kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml

<span class="token comment"># 看看etcd配置文件，发现etcd配置文件，里面指向的ip地址和api服务器配置文件中的不同，这就是原因</span>
root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># sudo vim kube-apiserver.yaml</span>
<span class="token punctuation">..</span>.
apiVersion: v1
kind: Pod
spec:
  containers:
  - command:
    - --advertise-address<span class="token operator">=</span><span class="token number">192.168</span>.8.6 <span class="token comment"># 顺便看看这个对不对，正常应该等于此机器的ip</span>
    - --etcd-servers<span class="token operator">=</span>https://1.1.1.1:2379  <span class="token comment">#改成- --etcd-servers=https://127.0.0.1:2379</span>
<span class="token punctuation">..</span>.

<span class="token comment"># API服务器连接的数据库地址不对，那正确的地址是什么？这是单节点，所以直接用127.0.0.1其实就行了，不过还是去etcd配置文件里看看</span>
<span class="token comment"># ok，已经发现了问题，将其在APIServer配置文件中修正，修正后，请至少等待30秒，然后再尝试，因为静态Pod可能需要30s才能扫描到更改，我们并不需要重启kubelet服务</span>
root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># sudo vim etcd.yaml</span>
apiVersion: v1
kind: Pod
spec:
  containers:
  - command:
    - etcd
    - --advertise-client-urls<span class="token operator">=</span>https://192.168.8.6:2379
<span class="token punctuation">..</span>.
<span class="token comment"># ok，已经发现了问题，将其在APIServer配置文件中修正，修正后，请至少等待30秒，然后再尝试，因为静态Pod可能需要30s才能扫描到更改，我们并不需要重启kubelet服务</span>

<span class="token comment"># 节点NotReady？看看pod咋样了，还是不对劲，kube-scheduler组件还是异常，它也是静态pod</span>
root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># kubectl get nodes</span>
NAME             STATUS     ROLES           AGE   VERSION
k8s-standalone   NotReady   control-plane   60d   v1.33.0

root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># kubectl get pod -A</span>
NAMESPACE     NAME                                     READY   STATUS                     RESTARTS     AGE
kube-system   coredns-746c97786-8vch4                  <span class="token number">0</span>/1     Pending                    <span class="token number">0</span>            60d
kube-system   coredns-746c97786-nb77d                  <span class="token number">0</span>/1     Pending                    <span class="token number">0</span>            60d
kube-system   etcd-k8s-standalone                      <span class="token number">1</span>/1     Running                    <span class="token number">2</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-system   kube-apiserver-k8s-standalone            <span class="token number">1</span>/1     Running                    <span class="token number">0</span>            60d
kube-system   kube-controller-manager-k8s-standalone   <span class="token number">1</span>/1     Running                    <span class="token number">4</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-system   kube-proxy-wbfsl                         <span class="token number">1</span>/1     Running                    <span class="token number">2</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-system   kube-scheduler-k8s-standalone            <span class="token number">0</span>/1     UnexpectedAdmissionError   <span class="token number">0</span>            60d

<span class="token comment"># 调度器也是用的静态pod，如果静态pod无法自动创建，那估计是文件内容有问题，我们直接创建，看看有啥问题？</span>
root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># kubectl create -f kube-scheduler.yaml</span>
pod/kube-scheduler created
root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># kubectl get pod -n kube-system</span>
NAME                                     READY   STATUS                     RESTARTS     AGE
coredns-746c97786-8vch4                  <span class="token number">0</span>/1     Pending                    <span class="token number">0</span>            60d
coredns-746c97786-nb77d                  <span class="token number">0</span>/1     Pending                    <span class="token number">0</span>            60d
etcd-k8s-standalone                      <span class="token number">1</span>/1     Running                    <span class="token number">2</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-apiserver-k8s-standalone            <span class="token number">1</span>/1     Running                    <span class="token number">0</span>            60d
kube-controller-manager-k8s-standalone   <span class="token number">1</span>/1     Running                    <span class="token number">4</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-proxy-wbfsl                         <span class="token number">1</span>/1     Running                    <span class="token number">2</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-scheduler                           <span class="token number">0</span>/1     Pending                    <span class="token number">0</span>            12s
kube-scheduler-k8s-standalone            <span class="token number">0</span>/1     UnexpectedAdmissionError   <span class="token number">0</span>            60d

<span class="token comment"># 看来创建没问题，但是起不来？能创建说明语法问题不大，那就先决条件不足，比如资源请求太多？</span>
root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># kubectl describe -n kube-system pod kube-scheduler | grep -i Requests -A 3</span>
    Requests:
      cpu:        <span class="token number">20</span>
    Liveness:     http-get https://127.0.0.1:10259/livez <span class="token assign-left variable">delay</span><span class="token operator">=</span>10s <span class="token assign-left variable">timeout</span><span class="token operator">=</span>15s <span class="token assign-left variable">period</span><span class="token operator">=</span>10s <span class="token comment">#success=1 #failure=8</span>
    Readiness:    http-get https://127.0.0.1:10259/readyz <span class="token assign-left variable">delay</span><span class="token operator">=</span>0s <span class="token assign-left variable">timeout</span><span class="token operator">=</span>15s <span class="token assign-left variable">period</span><span class="token operator">=</span>1s <span class="token comment">#success=1 #failure=3</span>

root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># sudo vim kube-scheduler.yaml</span>
apiVersion: v1
kind: Pod
spec:
<span class="token punctuation">..</span>.
    resources:
      requests:
        cpu: 20000m <span class="token comment">#直接改成100m意思意思得了，如果也是让你改成10%，记得通知我一下</span>
        

root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># kubectl delete -f kube-scheduler.yaml</span>
pod <span class="token string">"kube-scheduler"</span> deleted

root@k8s-standalone:/etc/kubernetes/manifests<span class="token comment"># kubectl get pod -n kube-system</span>
NAME                                     READY   STATUS    RESTARTS     AGE
coredns-746c97786-8vch4                  <span class="token number">0</span>/1     Pending   <span class="token number">0</span>            60d
coredns-746c97786-nb77d                  <span class="token number">0</span>/1     Pending   <span class="token number">0</span>            60d
etcd-k8s-standalone                      <span class="token number">1</span>/1     Running   <span class="token number">2</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-apiserver-k8s-standalone            <span class="token number">1</span>/1     Running   <span class="token number">0</span>            60d
kube-controller-manager-k8s-standalone   <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-proxy-wbfsl                         <span class="token number">1</span>/1     Running   <span class="token number">2</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-scheduler-k8s-standalone            <span class="token number">1</span>/1     Running   <span class="token number">0</span>            56s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="题目16-calico"><a href="#题目16-calico" class="headerlink" title="题目16: calico"></a><strong>题目16</strong>: calico</h1><p>  您必须连接到正确的主机。不这样做可能导致零分。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@k8s-master:~<span class="token comment"># ssh root@k8s-standalone</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>文档地址</strong></p>
<p>  Flannel Manifest</p>
<p>   <a target="_blank" rel="noopener" href="https://github.com/flannel-io/flannel/releases/download/v0.26.1/kube-flannel.yml">https://github.com/flannel-io/flannel/releases/download/v0.26.1/kube-flannel.yml</a></p>
<p>  Calico Manifest</p>
<p>   <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/projectcalico/calico/refs/tags/v3.30.2/manifests/tigera-operator.yaml">https://raw.githubusercontent.com/projectcalico/calico/refs/tags/v3.30.2/manifests/tigera-operator.yaml</a></p>
<p>  <strong>Context</strong></p>
<p>   集群的 CNI 未通过安全审核，已被移除。您必须安装一个可以实施网络策略的新 CNI。</p>
<p>  <strong>Task</strong></p>
<p>  安装并设置满足以下要求的容器网络接口（CNI）：</p>
<p>  选择并安装以下 CNI 选项之一：</p>
<p>   Flannel 版本 0.26.1</p>
<p>   Calico 版本 3.29.3</p>
<p>  选择的 CNI 必须：</p>
<p>   让 Pod 相互通信</p>
<p>   支持 Network Policy 实施</p>
<p>   从清单文件安装（请勿使用 Helm）</p>
<p>  <strong>解析</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 不要忘了切换集群，每道题前面都有给你ssh命令连接到相对应的机器，或者给你切换context的命令，你复制粘贴就行</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-master</span>

<span class="token comment"># 根据题目，ssh到root@k8s-standalone这个机器上</span>
root@k8s-master:~<span class="token comment"># ssh root@k8s-standalone</span>

<span class="token comment"># 题目提到，需要支持网络策略，这里直接选择calico</span>
root@k8s-standalone:~<span class="token comment"># kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/refs/tags/v3.30.2/manifests/tigera-operator.yaml</span>

<span class="token comment"># 看看现在集群中的 Pod CIDR是多少</span>
root@k8s-standalone:~<span class="token comment"># kubectl cluster-info dump | grep -i cluster-cidr</span>
                            <span class="token string">"--cluster-cidr=172.16.0.0/16"</span>,

<span class="token comment"># 最终的IP地址分发范围是: 172.16.0.0/16</span>
<span class="token comment"># 将这个CIDR填充到我们的CRD中，然后把CRD发布</span>
<span class="token function">wget</span> https://raw.githubusercontent.com/projectcalico/calico/refs/tags/v3.30.2/manifests/custom-resources.yaml

root@k8s-standalone:~<span class="token comment"># vim custom-resources.yaml</span>
apiVersion: operator.tigera.io/v1
kind: Installation
metadata:
  name: default
spec:
  <span class="token comment"># Configures Calico networking.</span>
  calicoNetwork:
    ipPools:
    - name: default-ipv4-ippool
      blockSize: <span class="token number">26</span>
      cidr: <span class="token number">192.168</span>.0.0/16 <span class="token comment"># 到时候看看这个文件里自带的是多少，把这个改成你刚查出来的172.16.0.0/16</span>
      encapsulation: VXLANCrossSubnet
      natOutgoing: Enabled
      nodeSelector: all<span class="token punctuation">(</span><span class="token punctuation">)</span>
      
<span class="token comment"># 向集群发布</span>
root@k8s-standalone:~<span class="token comment"># kubectl create -f custom-resources.yaml</span>

<span class="token comment"># 检查 Calico 组件运行状态</span>
root@k8s-standalone:~<span class="token comment"># kubectl get pod -A</span>
NAMESPACE          NAME                                       READY   STATUS    RESTARTS     AGE
calico-apiserver   calico-apiserver-6b5695b898-8fc5m          <span class="token number">1</span>/1     Running   <span class="token number">0</span>            62s
calico-apiserver   calico-apiserver-6b5695b898-wbgkn          <span class="token number">1</span>/1     Running   <span class="token number">0</span>            62s
calico-system      calico-kube-controllers-6899c9c99b-z9wbg   <span class="token number">1</span>/1     Running   <span class="token number">0</span>            58s
calico-system      calico-node-n7l2p                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>            59s
calico-system      calico-typha-5dd49f758b-6dql2              <span class="token number">1</span>/1     Running   <span class="token number">0</span>            59s
calico-system      csi-node-driver-l4sq6                      <span class="token number">2</span>/2     Running   <span class="token number">0</span>            58s
calico-system      goldmane-5f56496f4c-zppfp                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>            59s
calico-system      whisker-554b456567-j5smm                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>            53s
kube-system        coredns-746c97786-8vch4                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>            60d
kube-system        coredns-746c97786-nb77d                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>            60d
kube-system        etcd-k8s-standalone                        <span class="token number">1</span>/1     Running   <span class="token number">2</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-system        kube-apiserver-k8s-standalone              <span class="token number">1</span>/1     Running   <span class="token number">0</span>            60d
kube-system        kube-controller-manager-k8s-standalone     <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-system        kube-proxy-wbfsl                           <span class="token number">1</span>/1     Running   <span class="token number">2</span> <span class="token punctuation">(</span>8d ago<span class="token punctuation">)</span>   60d
kube-system        kube-scheduler-k8s-standalone              <span class="token number">1</span>/1     Running   <span class="token number">0</span>            12m
tigera-operator    tigera-operator-747864d56d-2w92r           <span class="token number">1</span>/1     Running   <span class="token number">0</span>            7m18s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>








                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">罗宇</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://linuxcenter.icu/2025/08/27/yun-wei-cong-ye-ji-zhu-ren-zheng/cka-ren-zheng-mo-ni-ti/">https://linuxcenter.icu/2025/08/27/yun-wei-cong-ye-ji-zhu-ren-zheng/cka-ren-zheng-mo-ni-ti/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">罗宇</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CKA%E8%AE%A4%E8%AF%81%E6%A8%A1%E6%8B%9F%E9%A2%98/">
                                    <span class="chip bg-color">CKA认证模拟题</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2025/08/27/yun-wei-cong-ye-ji-zhu-ren-zheng/cka-ren-zheng-mo-ni-ti/">
                    <div class="card-image">
                        
                        <img src="/img/K8S&practice.jpeg" class="responsive-img" alt="CKA认证模拟题">
                        
                        <span class="card-title">CKA认证模拟题</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            容器编排是指自动化地部署、扩展、管理和协调容器化应用的过程,它涉及到多个方面，如容器的调度、资源分配、容器之间的通信、故障恢复等
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-08-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%BF%90%E7%BB%B4%E4%BB%8E%E4%B8%9A%E6%8A%80%E6%9C%AF%E8%AE%A4%E8%AF%81/" class="post-category">
                                    运维从业技术认证
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CKA%E8%AE%A4%E8%AF%81%E6%A8%A1%E6%8B%9F%E9%A2%98/">
                        <span class="chip bg-color">CKA认证模拟题</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/06/03/rong-qi-ji-zhu/containerd-yuan-li-yu-shi-zhan/">
                    <div class="card-image">
                        
                        <img src="/img/containerd.jpeg" class="responsive-img" alt="containerd原理与实战">
                        
                        <span class="card-title">containerd原理与实战</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Containerd是一个开源的行业标准容器运行时，专注于管理容器的生命周期、镜像传输与存储、低级别存储和网络等功能
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-06-03
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/" class="post-category">
                                    容器技术
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/containerd%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98/">
                        <span class="chip bg-color">containerd原理与实战</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i
                    class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script
    src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




        <footer class="page-footer bg-color">
    
    <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="tencent"
                   type="playlist"
                   id="6402467630"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align"
        style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
            <span id="year">2021-2025</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">罗宇</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/"
                target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a
                href="https://github.com/blinkfox/hexo-theme-matery"
                target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">138.7k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span
                    id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span
                    id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            
            <!-- Baidu Analytics -->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7da0b91cd12d47a8bbf00c442b97ce74";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "6";
                    var startDate = "28";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
<a href="https://github.com/luovip/tecBlog.github.io" class="tooltipped" target="_blank"
    data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fab fa-github"></i>
</a>



<a href="mailto:luovipyu@163.com" class="tooltipped"
    target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
    <i class="fas fa-envelope-open"></i>
</a>



<a
    href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=252414302"
    class="tooltipped" target="_blank"
    data-tooltip="QQ联系我: 252414302" data-position="top"
    data-delay="50">
    <i class="fab fa-qq"></i>
</a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


        <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

        <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>

        <script
            src="/libs/materialize/materialize.min.js"></script>
        <script
            src="/libs/masonry/masonry.pkgd.min.js"></script>
        <script
            src="/libs/aos/aos.js"></script>
        <script
            src="/libs/scrollprogress/scrollProgress.min.js"></script>
        <script
            src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
        <script
            src="/js/matery.js"></script>

        <!-- Baidu Analytics -->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7da0b91cd12d47a8bbf00c442b97ce74";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

        <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

        
        <script
            src="/libs/others/clicklove.js"
            async="async"></script>
        
        
        <script async
            src="/libs/others/busuanzi.pure.mini.js"></script>
        

        

        

        
        
        <script type="text/javascript" color="64,224,208"
            pointColor="0,0,255"
            opacity='0.5'
            zIndex="-1"
            count="100"
            src="/libs/background/canvas-nest.js"></script>
        

        
        
        <script type="text/javascript" size="150"
            alpha='0.6'
            zIndex="-1"
            src="/libs/background/ribbon.min.js"
            async="async"></script>
        

        
        <script type="text/javascript"
            src="/libs/background/ribbon-dynamic.js"
            async="async"></script>
        

        
        <script
            src="/libs/instantpage/instantpage.js"
            type="module"></script>
        
        <!-- 冒泡 -->
        
        <script type="text/javascript">
        // 只在桌面版网页启用特效
        var windowWidth = $(window).width();
        document.write(
            '<script type="text/javascript" src="/libs/others/buble.js"><\/script>'
        );
    </script>
        
        <script type="text/javascript">
    var a_idx = 0;
jQuery(document).ready(function ($) {
    $("body").click(function (e) {
        var a = new Array("富强", "民主", "文明", "和谐", "自由", "平等", "公正", "法治", "爱国", "敬业", "诚信", "友善");
        var $i = $("<span/>").text(a[a_idx]);
        a_idx = (a_idx + 1) % a.length;
        var x = e.pageX,
            y = e.pageY;
        $i.css({
            "z-index": 5,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": "#FF0000"
        });
        $("body").append($i);
        $i.animate({
                "top": y - 180,
                "opacity": 0
            },
            3000,
            function () {
                $i.remove();
            });
    });
    setTimeout('delay()', 2000);
});
 
function delay() {
    $(".buryit").removeAttr("onclick");
}
 
    </script>
        <script type="text/javascript" src="/js/mouse_snow.js"></script>

        <!-- 动态标签栏 -->
        <script type="text/javascript">
      var OriginTitile = document.title, st; 
      document.addEventListener("visibilitychange", function () { 
        document.hidden ? (document.title = "爱我，别走！", clearTimeout(st)) : (document.title = "咦，你来啦！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) }) 
    </script>

    </body>

</html>
